function NativeJSBBEditor(n){function u(n){var c=function(){var a=h(),t=n.modal,l=document.createElement("div"),r=document.createElement("div"),u=document.createElement("div"),s=document.createElement("div"),c=document.createElement("div"),e=document.createElement("div"),o=document.createElement("input"),i=document.createElement("div");return c.className="body",s.className="head",s.innerHTML=t.Title||"��������� ����",u.className="wnd",r.className="bbeditor__modal__wrapper",r.style.width=(t.Width?t.Width:200)+"px",r.style.left=a.Width/2-(t.Width?t.Width:200)/2+"px",l.className="bbeditor__overlay",e.className="btn",o.type="button",o.value=t.ApplyButton?t.ApplyButton:"OK",i.type="button",i.innerHTML=t.CloseButton?t.CloseButton:"cancel",i.className="bbeditor__modal__close",i.addEventListener("click",f),e.appendChild(o),e.appendChild(i),u.appendChild(s),u.appendChild(c),u.appendChild(e),r.appendChild(u),this.buttonOk=o,this.buttonClose=i,this.body=c,this.wrapper=r,this.overlay=l,this},h=function(){return{Width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||window.screen.width||0,Height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||window.screen.height||0}},f=function(){var t=document.getElementsByClassName("bbeditor__overlay"),i=document.getElementsByClassName("bbeditor__modal__wrapper"),n;if(t.length)for(n=0;n<t.length;n++)t[n].parentNode.removeChild(t[n]);if(i.length)for(n=0;n<i.length;n++)i[n].parentNode.removeChild(i[n])},l=function(){var e=this,f=[],u=body.getElementsByTagName("input"),i=body.getElementsByTagName("select"),t;if(u.length)for(t=0;t<u.length;t++)f.push(u[t].getAttribute("tagOption")+'="'+u[t].value+'"');if(i.length)for(t=0;t<i.length;t++)f.push(i[t].getAttribute("tagOption")+'="'+i[t].options[i[t].selectedIndex].value+'"');r(n.tag,f)},u=c(),e,i,t,o,s;if(n&&n.modal&&n.modal.Fields&&Object.prototype.toString.call(n.modal.Fields)=="[object Array]")for(t in n.modal.Fields){if(e=document.createElement("label"),e.innerHTML=n.modal.Fields[t].Label,(n.modal.Fields[t].Type=="text"||n.modal.Fields[t].Type)&&(i=document.createElement("input"),i.type="text",i.name="f"+t,i.value=n.modal.Fields[t].DefaultValue?n.modal.Fields[t].DefaultValue:""),n.modal.Fields[t].Type=="dropdown"){if(i=document.createElement("select"),i.name="d"+t,o=[],n.modal.Fields[t].Values)for(s in n.modal.Fields[t].Values)o.push("<option value='"+n.modal.Fields[t].Values[s].Value+"'>"+n.modal.Fields[t].Values[s].Text+"<\/option>");i.innerHTML=o.join("")}i.setAttribute("tagOption",n.modal.Fields[t].TagOption);u.body.appendChild(e);u.body.appendChild(i)}u.buttonClose.addEventListener("click",function(){f()});u.buttonOk.addEventListener("click",function(){l();f()});document.body.appendChild(u.overlay);document.body.appendChild(u.wrapper);u.wrapper.style.top=h().Height/2-wrapper.clientWidth/2+"px"}function r(n,i,r){var e=i&&i.length?`[${n} ${i.join("")}]`:`[${n}]`,s=`[/${n}]`,u=t.textElement.value,f=t.textElement.selectionStart,h=t.textElement.selectionEnd,l=u.substring(f,h),o=0,c="";l&&!r?(o=h+e.length+s.length,c=`${u.substring(0,f)}${e}${l}${s}${u.substring(h)}`):(o=f+e.length,c=`${u.substring(0,f)}${e}${s}${u.substring(f)}`);t.textElement.value=c;t.textElement.focus();t.textElement.setSelectionRange(o,o)}function f(){var t={target:null,tags:[{tag:"b",separator:!1},{tag:"s",separator:!1},{tag:"i",separator:!1},{tag:"u",separator:!1},{separator:!0}],watermark:!0};for(var i in t)n[i]||(n[i]=t[i]);n.tags&&n.tags.length||(n.tags=t.tags)}function e(){var r,u;if(n.target){if(i=document.getElementById(n.target),i){r={};for(u in n.tags)r=document.createElement("div"),n.tags[u].space?r.className="tag space":(n.tags[u].caption&&(r.innerHTML=n.tags[u].tag),r.className="tag",r.setAttribute("tag",n.tags[u].tag),r.BBEditor=n.tags[u]),t.tagElements.push(r);t.wrap=document.createElement("div");t.wrap.className="bbeditor__wrap";t.watermark=document.createElement("div");t.watermark.className="watermark";t.watermark.innerHTML='NativeJS BB-editor, <a href="http://heap.tech">heap.tech<\/a> for more info';t.tagElements_wrap=document.createElement("div");t.tagElements_wrap.className="tags__wrap";t.textElement_wrap=document.createElement("div");t.textElement_wrap.className="text__wrap";t.textElement=document.createElement("textarea");t.textElement.id=i.id}}else console.error("target is not declared")}function o(){var r,f,u;if(t.wrap&&t.tagElements_wrap&&t.tagElements&&t.textElement_wrap&&t.textElement){r=i.parentNode;r.removeChild(i);for(f in t.tagElements)t.tagElements_wrap.appendChild(t.tagElements[f]);u=document.createElement("div");u.style.clear="both";t.tagElements_wrap.appendChild(u);n.watermark&&t.wrap.appendChild(t.watermark);t.textElement_wrap.appendChild(t.textElement);t.wrap.appendChild(t.tagElements_wrap);t.wrap.appendChild(t.textElement_wrap);r.appendChild(t.wrap)}}function s(){for(var n in t.tagElements)t.tagElements[n].addEventListener("click",function(){var n=this;n.BBEditor&&(n.BBEditor.modal?u(n.BBEditor):r(n.getAttribute("tag")))})}var i={},t={wrap:{},watermark:{},tagElements_wrap:{},tagElements:[],textElement_wrap:{},textElement:{}};return this instanceof NativeJSBBEditor?(f(),e(),o(),s(),t.wrap):new NativeJSBBEditor(n)}